# Архитектура и взаимодействие сервисов

## Общий обзор

Архитектура проекта построена по принципам микросервисной архитектуры с использованием Docker Compose, что позволяет легко масштабировать и поддерживать инфраструктуру.

Каждый сервис запускается в отдельном Docker-контейнере, взаимодействует с другими сервисами через внутреннюю сеть Docker и использует единую систему аутентификации.

## Состав сервисов

| Сервис         | Описание                                                                                                          | Роль в инфраструктуре                                              |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| **Nextcloud**  | Облачное хранилище и совместная работа над файлами                            | Центр совместной работы и хранения документов |
| **Collabora**  | Сервер для онлайн-редактирования документов                                        | Онлайн-редактор документов                                    |
| **Keycloak**   | Сервис централизованной аутентификации и управления доступом (SSO) | Единая точка входа и авторизации                          |
| **Moodle**     | Система дистанционного обучения                                                              | Образовательная платформа                                     |
| **Gitea**      | Платформа для хостинга git-репозиториев                                                   | Управление версиями и кодом                                   |
| **Nexus**      | Менеджер бинарных репозиториев и артефактов                                        | Управление и хранение ПО и пакетов                       |
| **Jitsi Meet** | Сервис видеоконференций                                                                             | Средство видео- и аудиосвязи                                  |
| **OpenLDAP**   | Сервис каталогов пользователей                                                                | Централизованное хранение учётных записей       |
| **PostgreSQL** | Реляционная база данных                                                                              | Основное хранилище данных платформы                   |

## Взаимодействие компонентов

### Схема взаимодействия

```
Пользователь -> Keycloak (SSO)
                 ↓
             JWT токен
                 ↓
Nextcloud, Moodle, Gitea (авторизация через токен)
                 ↓
       PostgreSQL, OpenLDAP (хранение данных)
                 ↓
Collabora (редактирование документов)
                 ↓
Nexus (хранение артефактов)
                 ↓
Jitsi Meet (видеосвязь)
```

### Процесс аутентификации

* Пользователь авторизуется через Keycloak.
* Keycloak возвращает JWT-токен.
* JWT-токен используется для авторизации во всех других сервисах.

### Хранение и доступ к данным

* PostgreSQL используется для хранения данных Nextcloud и Moodle.
* OpenLDAP хранит данные учётных записей и групп пользователей.
* Docker Volumes обеспечивают персистентное хранение файлов и данных базы.

### Совместная работа с документами

* Nextcloud обеспечивает доступ к документам.
* Документы открываются и редактируются через Collabora в режиме онлайн.
* Изменения сохраняются в Nextcloud.

### Коммуникации

* Jitsi Meet обеспечивает проведение видеоконференций.
* Доступ к Jitsi осуществляется по HTTPS.

## Сетевая инфраструктура

* Все контейнеры объединены общей внутренней сетью Docker (`pes_network`).
* Внешний доступ к сервисам предоставляется через заранее определенные порты.

## Возможности масштабирования

* Добавление новых сервисов осуществляется путём добавления контейнеров и настройки в Docker Compose.
* Возможна интеграция балансировщика нагрузки (Traefik/Nginx).

Таким образом, инфраструктура проекта обеспечивает гибкость, масштабируемость и лёгкость интеграции новых компонентов.
